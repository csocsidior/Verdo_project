%& C:\Users\CBalla\AppData\Roaming\TikzEdt\TikzEdt\023~1.0\TEMP_H~1
\begin{document}

\usetikzlibrary{shapes,positioning,matrix}
\begin{tikzpicture}[
scale = 1,
plain/.style={
  draw=none,
  fill=none,
  },
net2/.style={
  matrix of nodes,
  nodes={
    draw,
    circle,
    thick,
    inner sep=8pt
    },
  nodes in empty cells,
  column sep=2.3cm,
  row sep=-8pt
  },
>=latex
]

\matrix[net2] (mat)
{
 |[plain]|   &  & |[plain]|  \\
 |[plain]| & |[plain]|  \\
|[plain]| & |[plain]|  & \\
 |[plain]| & |[plain]| \\
 &    \\
|[plain]| & |[plain]| \\
|[plain]| & |[plain]|  &\\
|[plain]|& |[plain]| \\
&  \\
|[plain]| &   |[plain]| \\
|[plain]| & |[plain]|  & \\
  |[plain]| &  |[plain]| \\
   |[plain]|   &  & |[plain]|  \\
};

\draw[thick][<-] (mat-5-1) -- node[above] {$\bar{d}_{\mathcal{K},k}$} +(-1.5cm,0);
\draw[thick][<-] (mat-9-1) -- node[above] {$\sigma_k$} +(-1.5cm,0);
\draw[thick][<-] (mat-1-2) -- node[above] {$\hat{p}_k$} +(-1.5cm,0);
\draw[thick][<-] (mat-13-2) -- node[above] {$\hat{h}$} +(-1.5cm,0);
  
 
    \draw[->] (mat-5-1) -- (mat-5-2) node(){\footnotesize $\phi_1\!(\cdot)$};
    \draw [->] (mat-9-1) -- (mat-9-2) node(){\footnotesize$\phi\!_M\!(\cdot)$};
    
   \foreach \ai in {5,9}
  {\foreach \aii  in {5,9}
    \draw[thick][->] (mat-\ai-1) -- (mat-\aii-2) ;
  }
  
    \foreach \ai in {3,7,11}
  {\foreach \aii  in {1,5,9,13}
    \draw[thick][<-] (mat-\ai-3) -- (mat-\aii-2) ;
  }
  \draw[<-] (mat-3-3) --node[above]{} (mat-1-2)node(){ /};
    \draw[<-] (mat-11-3) --node[above]{} (mat-13-2)node(){ /};
  \draw[->] (mat-5-2) --node[above]{} (mat-7-3)node(){ $\sum$};
   \draw[->] (mat-5-2) --node[above]{} (mat-3-3)node(){ $\sum$};
   \draw[->] (mat-5-2) --node[above]{} (mat-11-3)node(){ $\sum$};

   
%     \draw[thick][->] (mat-3-2) --node[above]{$w\!_{1\!,1}$} (mat-3-3)node(){ $\sum$};
%   \draw[thick][->] (mat-7-2) --node[below]{} (mat-3-3);
% 
  \draw[thick][->] (mat-3-3) -- node[above] {$\hat{p}_{1\!A,(k+1)}$} +(2.8cm,0);
 \draw[thick][->] (mat-7-3) -- node[above] {$\hat{p}_{1\!B,(k+1)}$} +(2.8cm,0);
  \draw[thick][->] (mat-11-3) -- node[above] {$\hat{p}_{2,(k+1)}$} +(2.8cm,0);

 \node[circle,fill,inner sep=0.4pt] (A) at (0,-0.25) {};
 \node[circle,fill,inner sep=0.4pt] (A) at (0,0) {};
 \node[circle,fill,inner sep=0.4pt] (A) at (0,0.25) {};
 
 \draw[thick][<-] (mat-3-3) -- node[right] {$w_{0,1}$} +(0,1.1cm);
 \draw[thick][<-] (mat-7-3) -- node[right] {$w_{0,2}$} +(0,1.1cm);
  \draw[thick][<-] (mat-11-3) -- node[right] {$w_{0,3}$} +(0,1.1cm);
% 
% \node at (0.85,1.1) {$w\!_{1\!,2}$};
% \node at (0.99,-0.1) {$w\!_{M\!,1}$};
% 

\usetikzlibrary{calc}
\pgftransformreset
\node[inner sep=0pt,outer sep=0pt,minimum size=0pt,line width=0pt,text width=0pt,text height=0pt] at (current bounding box) {};
%add border to avoid cropping by pdflibnet
\foreach \border in {0.1}
  \useasboundingbox (current bounding box.south west)+(-\border,-\border) rectangle (current bounding box.north east)+(\border,\border);
\newwrite\metadatafile
\immediate\openout\metadatafile=\jobname_BB.txt
\path
  let
    \p1=(current bounding box.south west),
    \p2=(current bounding box.north east)
  in
  node[inner sep=0pt,outer sep=0pt,minimum size=0pt,line width=0pt,text width=0pt,text height=0pt,draw=white] at (current bounding box) {
\immediate\write\metadatafile{\p1,\p2}
};
\immediate\closeout\metadatafile
\end{tikzpicture}


\end{document}








