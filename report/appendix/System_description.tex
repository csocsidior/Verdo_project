\chapter{RBFNN-based identification on an example network}
\label{NN_based_example}

\emph{In Appendix F. a numerical example of the system identification is carried out on a simple network.}

\section{The example network in EPANET}
\label{example1_EPANET}

The reason for testing the identification method on data from a simple EPANET model is that, in simulation, several different operations of the network can be studied. On a real world network, typically the operation or control cannot be taken to its extremes, as this would mean undesired service to the customers . Therefore, the network shown in \figref{fig:epanet_example1_id} has been created to mimic the behaviour of a multi-inlet, single-WT system, such that the identification method, presented in \chapref{identification_design} is being tested. 

%EPANET example network for identification
\begin{figure}[H]
\centering
%\includegraphics[width=0.6\textwidth]{report/pictures/example1_epanetmodel}
\input{report/tikz/example1_id.tex} 
\caption{Multi-inlet, Single-WT example network.}
\label{fig:epanet_example1_id}
\end{figure}
\vspace{-3mm}

The network shown in \figref{fig:epanet_example1_id} consists of two pumping stations $PU_1$ and $PU_2$ and a Water Tank $TA$. Furthermore, reservoirs are present in the network, as in EPANET reservoirs are required for simulating pumps. These reservoirs $RE_1$ and $RE_2$ are different from WTs in the sense that they cannot be emptied in the simulation. Additionally, the physical and operational properties of the network can be found in \appref{physical_properties_example1}. 

The controls implemented on the network are based on simple time scheduling of the two pumping stations. Both pumps turn off when the pressure head in the WT is above $19.85 [m]$. $PU_2$ turns on again if the pressure head in the WT decreases to $19.55 [m]$. Furthermore, $PU_2$ turns on again only if the pressure head in node $n_1$ exceeds $43 [m]$. The initial pressure head in the WT is $19.5 [m]$.

\section{Identification and validation of the output equation}
\label{identification_and_validation_of_the_output_eq} 

The identification is carried out on the simulation data, exported from EPANET. In order to validate the identified model, scenarios with increased and decreased consumption patterns are taken intro account. It is worth noting, that the control properties of the network are kept the same, as any modification in control would mean a new operating point in the WSS. Thus, the model is tested by modifying the total demand and therefore creating different inlet pressure and flow settings for the two pumping stations. The identification is carried out on the network when the total consumption is $\sigma_1$. The validation is done when the total consumption is increased($\sigma_2$) and when decreased($\sigma_3$), respectively. Furthermore, all three consumption curves are periodic with a time period of 24 hours, however the validation has been done on a 72 hours long test data. \figref{fig:sigma123} shows the three different consumption patterns.

  %Total consumptions
 \begin{figure}[H]
 \centering
 %\hspace{0mm}
 %\includegraphics[width=0.35\textwidth]{report/pictures/missingfigure}
 \input{report/tikz/example_net/sigma123.tex} 
 \vspace{-2.5mm}
 \caption{Consumption patterns used for identification and validation.}
 \label{fig:sigma123}
 \end{figure}

 \vspace{-3mm}

 The inlet flows of the two pumping stations $PU_1$ and $PU_2$, and the WT pressure $\hat{p}$ are shown in \figref{fig:WT_sigma1}. 

 \vspace{-3mm}

   %Inlet flow - sigma1
 \begin{figure}[H]
 \centering
 %\hspace{0mm}
 %\includegraphics[width=0.35\textwidth]{report/pictures/missingfigure}
 \input{report/tikz/example_net/dk_sigma1.tex} 
 \vspace{-2.5mm}
 %\caption{Inlet flows of $PU_1$ and $PU_2$.}
 \label{fig:dk_sigma1}
 \end{figure}

 \vspace{-5mm}

   %WT - sigma1
 \begin{figure}[H]
 \centering
 \hspace{-4.5mm}
 %\includegraphics[width=0.35\textwidth]{report/pictures/missingfigure}
 \input{report/tikz/example_net/WT_sigma1.tex} 
 \vspace{-2.5mm}
 \caption{Inlet flows of $PU_1$ and $PU_2$(above) and the pressure in the WT(below).}
 \label{fig:WT_sigma1}
 \end{figure}

 \vspace{-3mm}

For the two inlet pressures $\bar{p}_{\mathcal{K}1}$ and $\bar{p}_{\mathcal{K}2}$, the identification has been carried out with 12 RBF neurons. The performance goal has been chosen to the order of $10^{-4}$. \figref{fig:MSE_output} shows the mean of squared errors in terms of RBF neurons. 

   %MSE output
 \begin{figure}[H]
 \centering
 %\hspace{0mm}
 %\includegraphics[width=0.35\textwidth]{report/pictures/missingfigure}
 \input{report/tikz/example_net/MSE_output.tex} 
 \vspace{-2.5mm}
 \caption{The networkâ€™s performance according to the mean of squared errors.}
 \label{fig:MSE_output}
 \end{figure}

 \vspace{-3mm}

As it is shown, a very good fit is achieved for a model which generalizes well the state equation. It is worth to mention that although more RBF neurons results in a more accurate fit, however it does not generalize so well the model as 12 RBF neurons do. In case of increasing the number of neurons, the identification resulted in overfit and the validation failed. The identification of $\bar{p}_{\mathcal{K}1}$ and $\bar{p}_{\mathcal{K}2}$ inlet pressures in case of $\sigma_1$ is shown in figref{}

\section{Identification and validation of the state equation}
\label{identification_and_validation_of_the_state_eq}  

abcd

\chapter{Example network description}
\label{physical_properties_example1}

\emph{In this part of the appendix, the corresponding physical parameters, control properties and consumption properties of the Multi-inlet, Single-WT example network are listed.}




